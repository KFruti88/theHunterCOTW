<div id="wp-custom-wrapper">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <div class="cotw-dashboard">
        <header class="tracker-header">
            <h1>COTW: Master Tracker</h1>
            <p id="stats-summary" class="status-text">Registry: Syncing...</p>
        </header>

        <div class="section-title">üó∫Ô∏è Tactical Reserve Map</div>
        <div id="map-viewport" class="map-viewport">
            <iframe id="map-frame" src="" class="map-iframe"></iframe>
            <div id="map-loader" class="map-loader-overlay">SELECT RESERVE TO LOAD MAP</div>
        </div>

        <div class="section-title">üìä Reserve Intel</div>
        <select id="map-selector" class="map-select-dropdown">
            <option>Connecting...</option>
        </select>

        <div id="species-harvest-root" class="grid-container"></div>
    </div>

    <style>
        #wp-custom-wrapper { width: 90%; margin: 0 auto; color: #fff; }
        .cotw-dashboard { background: #080c08; border: 2px solid #2ecc71; padding: 20px; border-radius: 12px; }
        .map-viewport { width: 100%; aspect-ratio: 16/9; background: #000; border: 1px solid #2ecc71; }
        .map-iframe { width: 100%; height: 100%; border: none; display: none; }
        @media (max-width: 768px) { .map-viewport { aspect-ratio: 1/1 !important; } }
    </style>

    <script type="module">
        const REGISTRY = "https://raw.githubusercontent.com/KFruti88/PSN/main/Skeleton/thehunter/map_data.json";
        const GITHUB_BASE = "https://kfruti88.github.io/PSN/Skeleton/thehunter/";

        async function start() {
            try {
                const res = await fetch(REGISTRY);
                const maps = await res.json();
                const selector = document.getElementById('map-selector');
                
                selector.innerHTML = '<option value="">-- CHOOSE RESERVE --</option>';
                Object.keys(maps).forEach(id => {
                    const opt = document.createElement('option');
                    opt.value = id; opt.text = maps[id].name;
                    selector.add(opt);
                });

                selector.onchange = (e) => {
                    const id = e.target.value;
                    if(!id) return;
                    document.getElementById('map-frame').src = `${GITHUB_BASE}${id}.html`;
                    document.getElementById('map-frame').style.display = "block";
                    document.getElementById('map-loader').style.display = "none";
                };
                document.getElementById('stats-summary').innerText = "Registry Synced";
            } catch (e) { console.error("Sync Failed", e); }
        }
        window.onload = start;
    </script>
</div>
